# OAuth2.0 の学習
  - 外部認証を利用することで、Web サービスは、ユーザーのパスワードやパスワードのハッシュ値などの情報を管理しなくて済むというメリットがある。
  - これは予想外の攻撃から Web サービスを守るためにも非常に有益なメリットなので、ぜひ自分で Web サービスを作成する際には、この外部認証を使った機構を積極的に利用したほうが良い。

## Oauth2.0 とは
  - Oauth2.0 とは、アプリケーションの利用者が、第三者のアプリケーションに権限を与えることで、そのアプリケーションの機能や認証を第三者のアプリケーションでも利用できるようにする仕組みのこと。
  - ここでは、GitHum 上のログインの認証機能を、自分が開発するアプリケーションにおいて利用できるようにするが、GitHub以外のWebサービス(例えば、Twitter や Google)でも、このOAuth2.0を利用した認証の機能が提供されている。
  - 仕組みとしては、HTTP の Authorization ヘッダを利用するが、認証時には暗号化されている HTTPS 通信を利用するようにすること。

## OAuth2.0 で認証機能を利用する流れ
  1. GitHub 上であなたが開発しているアプリケーションを登録する。
  1. GitHub への登録時に作ったトークンをあなたのアプリケーションに設定する。
  1. 利用者は、ログインしようとするとあなたが登録したアプリケーションが GitHub のユーザー認証情報を利用してログインしてよいか認可が求められるようになる。
  1. 利用者が許可すると、アプリケーションはGitHub からその利用者のユーザー情報を受け取れる。
  1. GitHub から受け取った情報を使って利用者を認証する。

## 今回必要となるnpmモジュール
  - passportモジュール
    - 様々なWebサービスとの外部認証を組み込むためのプラットフォームとなるライブラリ。
  - passport-github2モジュール
    - passport が GitHub の OAuth2.0 認証を利用するためのモジュール。
    - このようなモジュールのことを Strategy(戦略)モジュールと呼ぶ。
  - express-sessionモジュール
    - Express でセッションを利用できるようにするためのモジュール。
    - 認証した結果をセッション情報として維持するために、このモジュールが必要となる。

## process.nextTick 関数の役割
  - シングルスレッドで動く Node.js のイベントループを処理する仕組みの中で非常に重要な関数の一つである。
  - この関数を使わずに処理を書いた場合、外部認証を使ったログインが多発した際に、全ての通常のWebサービスの機能が全く動かなくなってしまうという問題が発生する。
  - この関数に処理したい関数をコールバック関数として渡して実行することで、すぐには実行を行わず、現在の処理が終わった後のタイミングでコールバック関数を実行することができる。

### Node.js のイベントループの仕組み
  この関数の役割を理解するためには、Node.js のイベントループの仕組みを理解する必要がある。  
  Node.js では非同期I/O を利用している間に別の処理を行ったり、非常に時間のかかる処理のせいで他の処理が滞ってしまわないようにするために、多くの処理がイベントループを利用して記述される。  
  イベントループは簡略化すると以下のようになっている。
  1. setTimeout 関数に登録されたコールバック関数の実行
  1. process.nextTick 関数に登録されているコールバック関数の実行(メインモジュールの実行）
  1. I/O イベントの発生
  1. I/O イベントのコールバック関数の実行
  1. process.nextTick 関数に登録されているコールバック関数の実行  
  このように非同期のI/Oイベントがいつやってくるかわからないので、I/Oイベントのコールバック関数が、process.nextTick関数に登録された関数の呼び出しに挟まる形でイベントループが設計されている。このイベントループに合わせて、nextTick関数のコールバック関数で処理を細切れにすることによって、他の時間のかかる処理がI/Oイベントから発生するイベントの処理を待たせる原因にならないようにしている。
